name: Master workflow
on:
  push:
    branches:
      - master
jobs:
  minikube:
    name: minikube
    runs-on: macos-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Install minikube
        id: install-minikube
        run: |
          brew install minikube hyperkit docker
          echo "::set-output name=cache-key::$(minikube version | md5)"
      - name: Cache minikube
        uses: actions/cache@v2
        with:
          path: |
            ~/.minikube/cache
            ~/.minikube/bin
          key: ${{ runner.os }}-minikube-${{ steps.install-minikube.outputs.cache-key }}
          restore-keys: |
            ${{ runner.os }}-minikube-
      - name: Run in minikube
        run: |
          minikube start --driver hyperkit --wait all
          minikube cache add alpine:latest
          eval $(minikube docker-env)
          docker build . -t testing
          docker container run testing
  docker-for-mac:
    name: Docker for Mac
    runs-on: macos-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Run in Docker for Mac
        run: |
          ./install-docker-for-mac.sh
          docker build . -t testing
          docker container run testing

